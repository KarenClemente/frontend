/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Component, Input, IterableDiffers, NgZone, ViewChild, ViewContainerRef } from '@angular/core';
import { ContentChild, ContentChildren, Directive, QueryList, TemplateRef } from '@angular/core';
import { InfiniteScroll } from './infinite-scroll';
/**
 * @template T
 */
export class InfiniteStaticMarker {
    /**
     * @param {?} template
     */
    constructor(template) {
        this.template = template;
        this.enabled = false;
    }
}
InfiniteStaticMarker.decorators = [
    { type: Directive, args: [{ selector: '[infiniteStatic]' },] },
];
/** @nocollapse */
InfiniteStaticMarker.ctorParameters = () => [
    { type: TemplateRef }
];
if (false) {
    /** @type {?} */
    InfiniteStaticMarker.prototype.enabled;
    /** @type {?} */
    InfiniteStaticMarker.prototype.template;
}
/**
 * @template T
 */
export class InfiniteTemplateMarker {
    /**
     * @param {?} template
     */
    constructor(template) {
        this.template = template;
    }
}
InfiniteTemplateMarker.decorators = [
    { type: Directive, args: [{ selector: '[infiniteTemplate]' },] },
];
/** @nocollapse */
InfiniteTemplateMarker.ctorParameters = () => [
    { type: TemplateRef }
];
if (false) {
    /** @type {?} */
    InfiniteTemplateMarker.prototype.template;
}
/**
 * @template T
 */
export class InfiniteScrollComponent extends InfiniteScroll {
    /**
     * @param {?} differs
     * @param {?} zone
     */
    constructor(differs, zone) {
        super(differs, zone);
        this._dummies = 0;
        this._outOfItems = false;
    }
    /**
     * @param {?} loading
     * @return {?}
     */
    set loading(loading) {
        this.subscribeLoading(loading);
    }
    /**
     * @param {?} scrollEnd
     * @return {?}
     */
    set end(scrollEnd) {
        this.subscribeEnd(scrollEnd);
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this._itemsStatic = this.staticMarkers.toArray();
        this.updateItems();
        this.update();
    }
    /**
     * @return {?}
     */
    update() {
        if (!this._items) {
            this._items = [];
            this._dummies = 0;
        }
        if (this._items && (!this._items.length || this._items.every((item) => item === undefined))) {
            this._items = [];
            this._dummies = 0;
            this.addDummies();
        }
        /** @type {?} */
        let staticLength = 0;
        if (this._itemsStatic) {
            staticLength = this._itemsStatic.length;
        }
        if (this.position < staticLength) {
            this.loading$.next(true);
            this._updateAfterRender$.next();
            this.updateItems();
            this.position += this.step;
        }
        else if (staticLength + this.position < this._items.length - this._dummies) {
            this.loading$.next(true);
            this._updateAfterRender$.next();
            this.position += this.step;
        }
        else if (this._subscriptionEnd) {
            this.loading$.next(true);
            this._end$.next();
            this.addDummies();
            this.position += this.step;
        }
    }
    /**
     * @param {?} newItems
     * @return {?}
     */
    newItems(newItems) {
        while (this._dummies > 0) {
            if (this._items.length) {
                this._items.pop();
            }
            this._dummies--;
        }
        /** @type {?} */
        const newItemsArray = Array.from(newItems);
        this.zone.run(() => {
            this._items = this._items.concat(newItemsArray);
        });
        // only continue when newItems arrive
        if (newItemsArray.length) {
            this._updateAfterRender$.next();
        }
        else {
            this._outOfItems = true;
        }
    }
    /**
     * @return {?}
     */
    updateItems() {
        this.zone.run(() => {
            for (const index in this._itemsStatic) {
                this._itemsStatic[index].enabled = this.position > index;
            }
        });
    }
    /**
     * @return {?}
     */
    addDummies() {
        this.zone.run(() => {
            if (!this._dummies && !this._outOfItems) {
                this._items = this._items.concat(Array(this.step).fill(undefined));
                this._dummies += this.step;
            }
        });
    }
}
InfiniteScrollComponent.decorators = [
    { type: Component, args: [{
                selector: 'infinite-scroll',
                template: `
    <ng-template ngFor let-item [ngForOf]="_itemsStatic">
      <ng-template [ngIf]="item.enabled">
        <ng-container *ngTemplateOutlet="item.template"></ng-container>
      </ng-template>
    </ng-template>
    <ng-template ngFor let-item [ngForOf]="_items">
      <ng-container *ngTemplateOutlet="templateMarker.template; context: {$implicit: item}"></ng-container>
    </ng-template>`
            },] },
];
/** @nocollapse */
InfiniteScrollComponent.ctorParameters = () => [
    { type: IterableDiffers },
    { type: NgZone }
];
InfiniteScrollComponent.propDecorators = {
    staticMarkers: [{ type: ContentChildren, args: [InfiniteStaticMarker,] }],
    templateMarker: [{ type: ContentChild, args: [InfiniteTemplateMarker,] }],
    dynamicTemplate: [{ type: ViewChild, args: ['dynamic',] }],
    position: [{ type: Input }],
    step: [{ type: Input }],
    offset: [{ type: Input }],
    delay: [{ type: Input }],
    loading: [{ type: Input }],
    end: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    InfiniteScrollComponent.prototype.staticMarkers;
    /** @type {?} */
    InfiniteScrollComponent.prototype.templateMarker;
    /** @type {?} */
    InfiniteScrollComponent.prototype.dynamicTemplate;
    /** @type {?} */
    InfiniteScrollComponent.prototype._itemsStatic;
    /** @type {?} */
    InfiniteScrollComponent.prototype._items;
    /** @type {?} */
    InfiniteScrollComponent.prototype._dummies;
    /** @type {?} */
    InfiniteScrollComponent.prototype._outOfItems;
    /** @type {?} */
    InfiniteScrollComponent.prototype.position;
    /** @type {?} */
    InfiniteScrollComponent.prototype.step;
    /** @type {?} */
    InfiniteScrollComponent.prototype.offset;
    /** @type {?} */
    InfiniteScrollComponent.prototype.delay;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5maW5pdGUtc2Nyb2xsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItaW5maW5pdGUtc2Nyb2xsLyIsInNvdXJjZXMiOlsibGliL2luZmluaXRlLXNjcm9sbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBbUIsU0FBUyxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQWMsTUFBTSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNuSSxPQUFPLEVBQUMsWUFBWSxFQUFFLGVBQWUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUcvRixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7Ozs7QUFHakQsTUFBTTs7OztJQUVKLFlBQW1CLFFBQXdCO1FBQXhCLGFBQVEsR0FBUixRQUFRLENBQWdCO3VCQUQxQixLQUFLO0tBQ3lCOzs7WUFIaEQsU0FBUyxTQUFDLEVBQUMsUUFBUSxFQUFFLGtCQUFrQixFQUFDOzs7O1lBTG9CLFdBQVc7Ozs7Ozs7Ozs7O0FBWXhFLE1BQU07Ozs7SUFDSixZQUFtQixRQUF3QztRQUF4QyxhQUFRLEdBQVIsUUFBUSxDQUFnQztLQUFJOzs7WUFGaEUsU0FBUyxTQUFDLEVBQUMsUUFBUSxFQUFFLG9CQUFvQixFQUFDOzs7O1lBWGtCLFdBQVc7Ozs7Ozs7OztBQTRCeEUsTUFBTSw4QkFBa0MsU0FBUSxjQUFpQjs7Ozs7SUFXL0QsWUFBWSxPQUF3QixFQUFFLElBQVk7UUFDaEQsS0FBSyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQzt3QkFKSixDQUFDOzJCQUNFLEtBQUs7S0FJMUI7Ozs7O0lBTUQsSUFDSSxPQUFPLENBQUMsT0FBbUM7UUFDN0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQ2hDOzs7OztJQUNELElBQ0ksR0FBRyxDQUFDLFNB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QkFRTzthQUNsQjs7OztZQTVCMkMsZUFBZTtZQUFjLE1BQU07Ozs0QkE4QjVFLGVBQWUsU0FBQyxvQkFBb0I7NkJBQ3BDLFlBQVksU0FBQyxzQkFBc0I7OEJBQ25DLFNBQVMsU0FBQyxTQUFTO3VCQVluQixLQUFLO21CQUNMLEtBQUs7cUJBQ0wsS0FBSztvQkFDTCxLQUFLO3NCQUNMLEtBQUs7a0JBSUwsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7TmdGb3JPZkNvbnRleHR9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7QWZ0ZXJDb250ZW50SW5pdCwgQ29tcG9uZW50LCBJbnB1dCwgSXRlcmFibGVEaWZmZXJzLCBOZ0l0ZXJhYmxlLCBOZ1pvbmUsIFZpZXdDaGlsZCwgVmlld0NvbnRhaW5lclJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7Q29udGVudENoaWxkLCBDb250ZW50Q2hpbGRyZW4sIERpcmVjdGl2ZSwgUXVlcnlMaXN0LCBUZW1wbGF0ZVJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQge0luZmluaXRlU2Nyb2xsfSBmcm9tICcuL2luZmluaXRlLXNjcm9sbCc7XHJcblxyXG5ARGlyZWN0aXZlKHtzZWxlY3RvcjogJ1tpbmZpbml0ZVN0YXRpY10nfSlcclxuZXhwb3J0IGNsYXNzIEluZmluaXRlU3RhdGljTWFya2VyPFQ+IHtcclxuICBwdWJsaWMgZW5hYmxlZCA9IGZhbHNlO1xyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8VD4pIHt9XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe3NlbGVjdG9yOiAnW2luZmluaXRlVGVtcGxhdGVdJ30pXHJcbmV4cG9ydCBjbGFzcyBJbmZpbml0ZVRlbXBsYXRlTWFya2VyPFQ+IHtcclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPE5nRm9yT2ZDb250ZXh0PFQ+Pikge31cclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdpbmZpbml0ZS1zY3JvbGwnLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICA8bmctdGVtcGxhdGUgbmdGb3IgbGV0LWl0ZW0gW25nRm9yT2ZdPVwiX2l0ZW1zU3RhdGljXCI+XHJcbiAgICAgIDxuZy10ZW1wbGF0ZSBbbmdJZl09XCJpdGVtLmVuYWJsZWRcIj5cclxuICAgICAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiaXRlbS50ZW1wbGF0ZVwiPjwvbmctY29udGFpbmVyPlxyXG4gICAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgPC9uZy10ZW1wbGF0ZT5cclxuICAgIDxuZy10ZW1wbGF0ZSBuZ0ZvciBsZXQtaXRlbSBbbmdGb3JPZl09XCJfaXRlbXNcIj5cclxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cInRlbXBsYXRlTWFya2VyLnRlbXBsYXRlOyBjb250ZXh0OiB7JGltcGxpY2l0OiBpdGVtfVwiPjwvbmctY29udGFpbmVyPlxyXG4gICAgPC9uZy10ZW1wbGF0ZT5gXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBJbmZpbml0ZVNjcm9sbENvbXBvbmVudDxUPiBleHRlbmRzIEluZmluaXRlU2Nyb2xsPFQ+IGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCB7XHJcbiAgQENvbnRlbnRDaGlsZHJlbihJbmZpbml0ZVN0YXRpY01hcmtlcikgc3RhdGljTWFya2VyczogUXVlcnlMaXN0PEluZmluaXRlU3RhdGljTWFya2VyPFQ+PjtcclxuICBAQ29udGVudENoaWxkKEluZmluaXRlVGVtcGxhdGVNYXJrZXIpIHRlbXBsYXRlTWFya2VyOiBJbmZpbml0ZVRlbXBsYXRlTWFya2VyPFQ+O1xyXG4gIEBWaWV3Q2hpbGQoJ2R5bmFtaWMnKSBkeW5hbWljVGVtcGxhdGU6IFZpZXdDb250YWluZXJSZWY7XHJcblxyXG4gIF9pdGVtc1N0YXRpYzogQXJyYXk8SW5maW5pdGVTdGF0aWNNYXJrZXI8VD4+O1xyXG4gIF9pdGVtczogQXJyYXk8VD47XHJcblxyXG4gIHByaXZhdGUgX2R1bW1pZXMgPSAwO1xyXG4gIHByaXZhdGUgX291dE9mSXRlbXMgPSBmYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IoZGlmZmVyczogSXRlcmFibGVEaWZmZXJzLCB6b25lOiBOZ1pvbmUpIHtcclxuICAgIHN1cGVyKGRpZmZlcnMsIHpvbmUpO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KCkgcG9zaXRpb247XHJcbiAgQElucHV0KCkgc3RlcDtcclxuICBASW5wdXQoKSBvZmZzZXQ7XHJcbiAgQElucHV0KCkgZGVsYXk7XHJcbiAgQElucHV0KClcclxuICBzZXQgbG9hZGluZyhsb2FkaW5nOiAobG9hZGluZzogYm9vbGVhbikgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5zdWJzY3JpYmVMb2FkaW5nKGxvYWRpbmcpO1xyXG4gIH1cclxuICBASW5wdXQoKVxyXG4gIHNldCBlbmQoc2Nyb2xsRW5kOiAocG9zaXRpb246IG51bWJlciwgaW50ZXJ2YWw6IG51bWJlcikgPT4gT2JzZXJ2YWJsZTxOZ0l0ZXJhYmxlPFQ+Pikge1xyXG4gICAgdGhpcy5zdWJzY3JpYmVFbmQoc2Nyb2xsRW5kKTtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcclxuICAgIHRoaXMuX2l0ZW1zU3RhdGljID0gdGhpcy5zdGF0aWNNYXJrZXJzLnRvQXJyYXkoKTtcclxuICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcclxuICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgdXBkYXRlKCkge1xyXG4gICAgaWYgKCF0aGlzLl9pdGVtcykge1xyXG4gICAgICB0aGlzLl9pdGVtcyA9IFtdO1xyXG4gICAgICB0aGlzLl9kdW1taWVzID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5faXRlbXMgJiYgKCF0aGlzLl9pdGVtcy5sZW5ndGggfHwgdGhpcy5faXRlbXMuZXZlcnkoKGl0ZW0pID0+IGl0ZW0gPT09IHVuZGVmaW5lZCkpKSB7XHJcbiAgICAgIHRoaXMuX2l0ZW1zID0gW107XHJcbiAgICAgIHRoaXMuX2R1bW1pZXMgPSAwO1xyXG4gICAgICB0aGlzLmFkZER1bW1pZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgc3RhdGljTGVuZ3RoID0gMDtcclxuICAgIGlmICh0aGlzLl9pdGVtc1N0YXRpYykge1xyXG4gICAgICBzdGF0aWNMZW5ndGggPSB0aGlzLl9pdGVtc1N0YXRpYy5sZW5ndGhcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5wb3NpdGlvbiA8IHN0YXRpY0xlbmd0aCkge1xyXG4gICAgICB0aGlzLmxvYWRpbmckLm5leHQodHJ1ZSk7XHJcbiAgICAgIHRoaXMuX3VwZGF0ZUFmdGVyUmVuZGVyJC5uZXh0KCk7XHJcbiAgICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcclxuICAgICAgdGhpcy5wb3NpdGlvbiArPSB0aGlzLnN0ZXA7XHJcbiAgICB9IGVsc2UgaWYgKHN0YXRpY0xlbmd0aCArIHRoaXMucG9zaXRpb24gPCB0aGlzLl9pdGVtcy5sZW5ndGggLSB0aGlzLl9kdW1taWVzKSB7XHJcbiAgICAgIHRoaXMubG9hZGluZyQubmV4dCh0cnVlKTtcclxuICAgICAgdGhpcy5fdXBkYXRlQWZ0ZXJSZW5kZXIkLm5leHQoKTtcclxuICAgICAgdGhpcy5wb3NpdGlvbiArPSB0aGlzLnN0ZXA7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbkVuZCkge1xyXG4gICAgICB0aGlzLmxvYWRpbmckLm5leHQodHJ1ZSk7XHJcbiAgICAgIHRoaXMuX2VuZCQubmV4dCgpO1xyXG4gICAgICB0aGlzLmFkZER1bW1pZXMoKTtcclxuICAgICAgdGhpcy5wb3NpdGlvbiArPSB0aGlzLnN0ZXA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgbmV3SXRlbXMobmV3SXRlbXM6IE5nSXRlcmFibGU8VD4pIHtcclxuICAgIHdoaWxlICh0aGlzLl9kdW1taWVzID4gMCkge1xyXG4gICAgICBpZiAodGhpcy5faXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMucG9wKCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fZHVtbWllcy0tO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbmV3SXRlbXNBcnJheSA9IEFycmF5LmZyb20obmV3SXRlbXMpO1xyXG4gICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5faXRlbXMuY29uY2F0KG5ld0l0ZW1zQXJyYXkpO1xyXG4gICAgfSk7XHJcbiAgICAvLyBvbmx5IGNvbnRpbnVlIHdoZW4gbmV3SXRlbXMgYXJyaXZlXHJcbiAgICBpZiAobmV3SXRlbXNBcnJheS5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5fdXBkYXRlQWZ0ZXJSZW5kZXIkLm5leHQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX291dE9mSXRlbXMgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVJdGVtcygpIHtcclxuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICBmb3IgKGNvbnN0IGluZGV4IGluIHRoaXMuX2l0ZW1zU3RhdGljKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXNTdGF0aWNbaW5kZXhdLmVuYWJsZWQgPSB0aGlzLnBvc2l0aW9uID4gaW5kZXg7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGREdW1taWVzKCkge1xyXG4gICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5fZHVtbWllcyAmJiAhdGhpcy5fb3V0T2ZJdGVtcykge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5faXRlbXMuY29uY2F0KEFycmF5KHRoaXMuc3RlcCkuZmlsbCh1bmRlZmluZWQpKTtcclxuICAgICAgICB0aGlzLl9kdW1taWVzICs9IHRoaXMuc3RlcDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==