/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { NgForOf } from '@angular/common';
import { BehaviorSubject, interval, merge, Observable, Subject } from 'rxjs';
import { exhaustMap, switchMap, take } from 'rxjs/operators';
import { DEFAULTS } from './defaults';
/**
 * @abstract
 * @template T
 */
export class InfiniteScroll {
    /**
     * @param {?} _differs
     * @param {?} zone
     */
    constructor(_differs, zone) {
        this._differs = _differs;
        this.zone = zone;
        this._userEnd$ = new Observable();
        this._end$ = new Subject();
        this._updateAfterRender$ = new Subject();
        this.position = DEFAULTS.POSITION;
        this.step = DEFAULTS.STEP;
        this.offset = DEFAULTS.OFFSET;
        this.delay = DEFAULTS.DELAY;
        this.loading$ = new BehaviorSubject(false);
        zone.runOutsideAngular(() => {
            window.addEventListener('scroll', () => this._update());
            window.addEventListener('resize', () => this._update());
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this._subscriptionLoadingEnd = merge(this._userEnd$, this._updateAfterRender$).subscribe(() => this.loading$.next(false));
        this._subscriptionUpdateAfterRender =
            this._updateAfterRender$.pipe(switchMap(() => interval(this.delay).pipe(take(1)))).subscribe(() => this._update());
        this._update();
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        if (this._ngFor) {
            this._ngFor.ngDoCheck();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroy(this._subscriptionEnd);
        this.destroy(this._subscriptionLoading);
        this.destroy(this._subscriptionLoadingEnd);
        this.destroy(this._subscriptionUpdateAfterRender);
    }
    /**
     * @param {?} viewContainer
     * @param {?} template
     * @return {?}
     */
    createNgFor(viewContainer, template) {
        this._ngFor = new NgForOf(viewContainer, template, this._differs);
    }
    /**
     * @param {?} loading
     * @return {?}
     */
    subscribeLoading(loading) {
        this.destroy(this._subscriptionLoading);
        this._subscriptionLoading = this.loading$.subscribe(loading);
    }
    /**
     * @param {?} scrollEnd
     * @return {?}
     */
    subscribeEnd(scrollEnd) {
        this.destroy(this._subscriptionEnd);
        this._userEnd$ = this._end$.pipe(exhaustMap(() => scrollEnd(this.position, this.step)));
        this._subscriptionEnd = this._userEnd$.subscribe(this.newItems.bind(this), () => this.newItems.bind(this)([]));
    }
    /**
     * @return {?}
     */
    _update() {
        /** @type {?} */
        const scrollHeight = window.innerHeight + window.scrollY;
        if (scrollHeight >= document.body.offsetHeight - this.offset) {
            this.zone.runOutsideAngular(() => {
                this.update();
            });
        }
    }
    /**
     * @param {?} subscription
     * @return {?}
     */
    destroy(subscription) {
        if (subscription && !subscription.closed) {
            subscription.unsubscribe();
        }
    }
}
if (false) {
    /** @type {?} */
    InfiniteScroll.prototype._subscriptionLoading;
    /** @type {?} */
    InfiniteScroll.prototype._subscriptionLoadingEnd;
    /** @type {?} */
    InfiniteScroll.prototype._userEnd$;
    /** @type {?} */
    InfiniteScroll.prototype._subscriptionEnd;
    /** @type {?} */
    InfiniteScroll.prototype._subscriptionUpdateAfterRender;
    /** @type {?} */
    InfiniteScroll.prototype._end$;
    /** @type {?} */
    InfiniteScroll.prototype._updateAfterRender$;
    /** @type {?} */
    InfiniteScroll.prototype._ngFor;
    /** @type {?} */
    InfiniteScroll.prototype.position;
    /** @type {?} */
    InfiniteScroll.prototype.step;
    /** @type {?} */
    InfiniteScroll.prototype.offset;
    /** @type {?} */
    InfiniteScroll.prototype.delay;
    /** @type {?} */
    InfiniteScroll.prototype.loading$;
    /** @type {?} */
    InfiniteScroll.prototype._differs;
    /** @type {?} */
    InfiniteScroll.prototype.zone;
    /**
     * @abstract
     * @return {?}
     */
    InfiniteScroll.prototype.update = function () { };
    /**
     * @abstract
     * @param {?} newItems
     * @return {?}
     */
    InfiniteScroll.prototype.newItems = function (newItems) { };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5maW5pdGUtc2Nyb2xsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1pbmZpbml0ZS1zY3JvbGwvIiwic291cmNlcyI6WyJsaWIvaW5maW5pdGUtc2Nyb2xsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsT0FBTyxFQUFpQixNQUFNLGlCQUFpQixDQUFDO0FBRXhELE9BQU8sRUFBQyxlQUFlLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFlLE1BQU0sTUFBTSxDQUFDO0FBQ3pGLE9BQU8sRUFBQyxVQUFVLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxZQUFZLENBQUM7Ozs7O0FBRXBDLE1BQU07Ozs7O0lBYUosWUFBb0IsUUFBeUIsRUFBUyxJQUFZO1FBQTlDLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBUTt5QkFWOUMsSUFBSSxVQUFVLEVBQWlCO3FCQUtqQyxJQUFJLE9BQU8sRUFBaUI7bUNBQ2QsSUFBSSxPQUFPLEVBQU87d0JBV3ZDLFFBQVEsQ0FBQyxRQUFRO29CQUNyQixRQUFRLENBQUMsSUFBSTtzQkFDWCxRQUFRLENBQUMsTUFBTTtxQkFDaEIsUUFBUSxDQUFDLEtBQUs7d0JBQ1gsSUFBSSxlQUFlLENBQVUsS0FBSyxDQUFDO1FBVjVDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7WUFDMUIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN4RCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1NBQ3pELENBQUMsQ0FBQztLQUNKOzs7O0lBUUQsUUFBUTtR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QUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDekMsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQzVCOztDQU1KIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtOZ0Zvck9mLCBOZ0Zvck9mQ29udGV4dH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHtEb0NoZWNrLCBJdGVyYWJsZURpZmZlcnMsIE5nSXRlcmFibGUsIE5nWm9uZSwgT25EZXN0cm95LCBPbkluaXQsIFRlbXBsYXRlUmVmLCBWaWV3Q29udGFpbmVyUmVmfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtCZWhhdmlvclN1YmplY3QsIGludGVydmFsLCBtZXJnZSwgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9ufSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtleGhhdXN0TWFwLCBzd2l0Y2hNYXAsIHRha2V9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7REVGQVVMVFN9IGZyb20gJy4vZGVmYXVsdHMnO1xyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEluZmluaXRlU2Nyb2xsPFQ+IGltcGxlbWVudHMgT25Jbml0LCBEb0NoZWNrLCBPbkRlc3Ryb3kge1xyXG4gIHByaXZhdGUgX3N1YnNjcmlwdGlvbkxvYWRpbmc6IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIF9zdWJzY3JpcHRpb25Mb2FkaW5nRW5kOiBTdWJzY3JpcHRpb247XHJcbiAgcHJpdmF0ZSBfdXNlckVuZCQgPSBuZXcgT2JzZXJ2YWJsZTxOZ0l0ZXJhYmxlPFQ+PigpO1xyXG5cclxuICBwcm90ZWN0ZWQgX3N1YnNjcmlwdGlvbkVuZDogU3Vic2NyaXB0aW9uO1xyXG4gIHByb3RlY3RlZCBfc3Vic2NyaXB0aW9uVXBkYXRlQWZ0ZXJSZW5kZXI6IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgcHJvdGVjdGVkIF9lbmQkID0gbmV3IFN1YmplY3Q8TmdJdGVyYWJsZTxUPj4oKTtcclxuICBwcm90ZWN0ZWQgX3VwZGF0ZUFmdGVyUmVuZGVyJCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuXHJcbiAgcHJvdGVjdGVkIF9uZ0ZvcjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfZGlmZmVyczogSXRlcmFibGVEaWZmZXJzLCBwdWJsaWMgem9uZTogTmdab25lKSB7XHJcbiAgICB6b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsICgpID0+IHRoaXMuX3VwZGF0ZSgpKTtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHRoaXMuX3VwZGF0ZSgpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcG9zaXRpb24gPSBERUZBVUxUUy5QT1NJVElPTjtcclxuICBzdGVwID0gREVGQVVMVFMuU1RFUDtcclxuICBvZmZzZXQgPSBERUZBVUxUUy5PRkZTRVQ7XHJcbiAgZGVsYXkgPSBERUZBVUxUUy5ERUxBWTtcclxuICBsb2FkaW5nJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuX3N1YnNjcmlwdGlvbkxvYWRpbmdFbmQgPSBtZXJnZSh0aGlzLl91c2VyRW5kJCwgdGhpcy5fdXBkYXRlQWZ0ZXJSZW5kZXIkKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5sb2FkaW5nJC5uZXh0KGZhbHNlKSk7XHJcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25VcGRhdGVBZnRlclJlbmRlciA9XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlQWZ0ZXJSZW5kZXIkLnBpcGUoc3dpdGNoTWFwKCgpID0+IGludGVydmFsKHRoaXMuZGVsYXkpLnBpcGUodGFrZSgxKSkpKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5fdXBkYXRlKCkpO1xyXG5cclxuICAgIHRoaXMuX3VwZGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgbmdEb0NoZWNrKCkge1xyXG4gICAgaWYgKHRoaXMuX25nRm9yKSB7XHJcbiAgICAgIHRoaXMuX25nRm9yLm5nRG9DaGVjaygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLmRlc3Ryb3kodGhpcy5fc3Vic2NyaXB0aW9uRW5kKTtcclxuICAgIHRoaXMuZGVzdHJveSh0aGlzLl9zdWJzY3JpcHRpb25Mb2FkaW5nKTtcclxuICAgIHRoaXMuZGVzdHJveSh0aGlzLl9zdWJzY3JpcHRpb25Mb2FkaW5nRW5kKTtcclxuICAgIHRoaXMuZGVzdHJveSh0aGlzLl9zdWJzY3JpcHRpb25VcGRhdGVBZnRlclJlbmRlcik7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgY3JlYXRlTmdGb3Iodmlld0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZiwgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPE5nRm9yT2ZDb250ZXh0PFQ+Pikge1xyXG4gICAgdGhpcy5fbmdGb3IgPSBuZXcgTmdGb3JPZjxUPih2aWV3Q29udGFpbmVyLCB0ZW1wbGF0ZSwgdGhpcy5fZGlmZmVycyk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgc3Vic2NyaWJlTG9hZGluZyhsb2FkaW5nOiAobG9hZGluZzogYm9vbGVhbikgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5kZXN0cm95KHRoaXMuX3N1YnNjcmlwdGlvbkxvYWRpbmcpO1xyXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uTG9hZGluZyA9IHRoaXMubG9hZGluZyQuc3Vic2NyaWJlKGxvYWRpbmcpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIHN1YnNjcmliZUVuZChzY3JvbGxFbmQ6IChwb3NpdGlvbjogbnVtYmVyLCBpbnRlcnZhbDogbnVtYmVyKSA9PiBPYnNlcnZhYmxlPE5nSXRlcmFibGU8VD4+KSB7XHJcbiAgICB0aGlzLmRlc3Ryb3kodGhpcy5fc3Vic2NyaXB0aW9uRW5kKTtcclxuICAgIHRoaXMuX3VzZXJFbmQkID0gdGhpcy5fZW5kJC5waXBlKGV4aGF1c3RNYXAoKCkgPT4gc2Nyb2xsRW5kKHRoaXMucG9zaXRpb24sIHRoaXMuc3RlcCkpKTtcclxuICAgIHRoaXMuX3N1YnNjcmlwdGlvbkVuZCA9IHRoaXMuX3VzZXJFbmQkLnN1YnNjcmliZSh0aGlzLm5ld0l0ZW1zLmJpbmQodGhpcyksICgpID0+IHRoaXMubmV3SXRlbXMuYmluZCh0aGlzKShbXSkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdXBkYXRlKCkge1xyXG4gICAgY29uc3Qgc2Nyb2xsSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0ICsgd2luZG93LnNjcm9sbFk7XHJcbiAgICBpZiAoc2Nyb2xsSGVpZ2h0ID49IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0IC0gdGhpcy5vZmZzZXQpIHtcclxuICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVzdHJveShzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbikge1xyXG4gICAgaWYgKHN1YnNjcmlwdGlvbiAmJiAhc3Vic2NyaXB0aW9uLmNsb3NlZCkge1xyXG4gICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCB1cGRhdGUoKTtcclxuXHJcbiAgcHJvdGVjdGVkIGFic3RyYWN0IG5ld0l0ZW1zKG5ld0l0ZW1zOiBOZ0l0ZXJhYmxlPFQ+KTtcclxufVxyXG4iXX0=