/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, Input, IterableDiffers } from '@angular/core';
import { NgZone, TemplateRef, ViewContainerRef } from '@angular/core';
import { DEFAULTS } from './defaults';
import { InfiniteScroll } from './infinite-scroll';
/**
 * @template T
 */
var InfiniteScrollDirective = /** @class */ (function (_super) {
    tslib_1.__extends(InfiniteScrollDirective, _super);
    function InfiniteScrollDirective(viewContainer, templateRef, differs, zone) {
        var _this = _super.call(this, differs, zone) || this;
        _this._positionInitial = DEFAULTS.POSITION;
        _this._dummies = 0;
        _this._outOfItems = false;
        _this.step = DEFAULTS.STEP;
        _this.offset = DEFAULTS.OFFSET;
        _this.delay = DEFAULTS.DELAY;
        _this.createNgFor(viewContainer, templateRef);
        return _this;
    }
    Object.defineProperty(InfiniteScrollDirective.prototype, "infiniteScrollOf", {
        set: /**
         * @param {?} infiniteScrollOf
         * @return {?}
         */
        function (infiniteScrollOf) {
            if (infiniteScrollOf) {
                this._items = Array.from(infiniteScrollOf);
            }
            this.position = this._positionInitial;
            this._dummies = 0;
            this.updateItems();
            this.update();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InfiniteScrollDirective.prototype, "infiniteScrollTrackBy", {
        get: /**
         * @return {?}
         */
        function () {
            return this._ngFor.ngForTrackBy;
        },
        set: /**
         * @param {?} fn
         * @return {?}
         */
        function (fn) {
            this._ngFor.ngForTrackBy = fn;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InfiniteScrollDirective.prototype, "infiniteScrollTemplate", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._ngFor.ngForTemplate = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InfiniteScrollDirective.prototype, "infiniteScrollPosition", {
        set: /**
         * @param {?} position
         * @return {?}
         */
        function (position) {
            if (position === undefined || position === null) {
                this.position = DEFAULTS.POSITION;
            }
            else {
                this.position = position;
            }
            this._positionInitial = position;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InfiniteScrollDirective.prototype, "infiniteScrollLoading", {
        set: /**
         * @param {?} loading
         * @return {?}
         */
        function (loading) {
            this.subscribeLoading(loading);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InfiniteScrollDirective.prototype, "infiniteScrollEnd", {
        set: /**
         * @param {?} scrollEnd
         * @return {?}
         */
        function (scrollEnd) {
            this.subscribeEnd(scrollEnd);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    InfiniteScrollDirective.prototype.update = /**
     * @return {?}
     */
    function () {
        if (!this._items) {
            this._items = [];
        }
        if (this._items && (!this._items.length || this._items.every(function (item) { return item === undefined; }))) {
            this._items = [];
            this.addDummies();
            this.updateItems();
        }
        if (this.position < this._items.length - this._dummies) {
            this.loading$.next(true);
            this.updateItems();
            this._updateAfterRender$.next();
            this.position += this.step;
        }
        else if (this._subscriptionEnd) {
            this.loading$.next(true);
            this._end$.next();
            this.position += this.step;
            this.addDummies();
            this.updateItems();
        }
    };
    /**
     * @param {?} newItems
     * @return {?}
     */
    InfiniteScrollDirective.prototype.newItems = /**
     * @param {?} newItems
     * @return {?}
     */
    function (newItems) {
        while (this._dummies > 0) {
            if (this._items.length) {
                this._items.pop();
            }
            this._dummies--;
        }
        /** @type {?} */
        var newItemsArray = Array.from(newItems);
        this._items = this._items.concat(newItemsArray);
        this.updateItems();
        // only continue when newItems arrive
        if (newItemsArray.length) {
            this._updateAfterRender$.next();
        }
        else {
            this._outOfItems = true;
        }
    };
    /**
     * @return {?}
     */
    InfiniteScrollDirective.prototype.updateItems = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.zone.run(function () {
            if (_this._items) {
                // update ngForOf<T> directive
                // update ngForOf<T> directive
                _this._ngFor.ngForOf = _this._items.slice(0, _this.position);
            }
        });
    };
    /**
     * @return {?}
     */
    InfiniteScrollDirective.prototype.addDummies = /**
     * @return {?}
     */
    function () {
        if (!this._dummies && !this._outOfItems) {
            this._items = this._items.concat(Array(this.step).fill(undefined));
            this._dummies += this.step;
        }
    };
    InfiniteScrollDirective.decorators = [
        { type: Directive, args: [{ selector: '[infiniteScroll]' },] },
    ];
    /** @nocollapse */
    InfiniteScrollDirective.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: TemplateRef },
        { type: IterableDiffers },
        { type: NgZone }
    ]; };
    InfiniteScrollDirective.propDecorators = {
        infiniteScrollOf: [{ type: Input }],
        infiniteScrollTrackBy: [{ type: Input }],
        infiniteScrollTemplate: [{ type: Input }],
        infiniteScrollPosition: [{ type: Input }],
        step: [{ type: Input, args: ['infiniteScrollStep',] }],
        offset: [{ type: Input, args: ['infiniteScrollOffset',] }],
        delay: [{ type: Input, args: ['infiniteScrollDelay',] }],
        infiniteScrollLoading: [{ type: Input }],
        infiniteScrollEnd: [{ type: Input }]
    };
    return InfiniteScrollDirective;
}(InfiniteScroll));
export { InfiniteScrollDirective };
if (false) {
    /** @type {?} */
    InfiniteScrollDirective.prototype._items;
    /** @type {?} */
    InfiniteScrollDirective.prototype._positionInitial;
    /** @type {?} */
    InfiniteScrollDirective.prototype._dummies;
    /** @type {?} */
    InfiniteScrollDirective.prototype._outOfItems;
    /** @type {?} */
    InfiniteScrollDirective.prototype.step;
    /** @type {?} */
    InfiniteScrollDirective.prototype.offset;
    /** @type {?} */
    InfiniteScrollDirective.prototype.delay;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5maW5pdGUtc2Nyb2xsLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItaW5maW5pdGUtc2Nyb2xsLyIsInNvdXJjZXMiOlsibGliL2luZmluaXRlLXNjcm9sbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQWdDLE1BQU0sZUFBZSxDQUFDO0FBQy9GLE9BQU8sRUFBQyxNQUFNLEVBQUUsV0FBVyxFQUFtQixnQkFBZ0IsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUVyRixPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBQ3BDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQzs7Ozs7SUFHRCxtREFBaUI7SUFPL0QsaUNBQVksYUFBK0IsRUFBRSxXQUEyQyxFQUFFLE9BQXdCLEVBQUUsSUFBWTtRQUFoSSxZQUNFLGtCQUFNLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FFckI7aUNBUjBCLFFBQVEsQ0FBQyxRQUFRO3lCQUV6QixDQUFDOzRCQUNFLEtBQUs7cUJBdUNTLFFBQVEsQ0FBQyxJQUFJO3VCQUNULFFBQVEsQ0FBQyxNQUFNO3NCQUNqQixRQUFRLENBQUMsS0FBSztRQXJDbEQsS0FBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLEVBQUUsV0FBVyxDQUFDLENBQUM7O0tBQzlDO0lBRUQsc0JBQ0kscURBQWdCOzs7OztRQURwQixVQUNxQixnQkFBK0I7WUFDbEQsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQzthQUM1QztZQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDO1lBQ3RDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1lBQ2xC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S0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNuRSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDNUI7OztnQkFsSEosU0FBUyxTQUFDLEVBQUMsUUFBUSxFQUFFLGtCQUFrQixFQUFDOzs7O2dCQUxLLGdCQUFnQjtnQkFBOUMsV0FBVztnQkFERCxlQUFlO2dCQUNqQyxNQUFNOzs7bUNBa0JYLEtBQUs7d0NBVUwsS0FBSzt5Q0FRTCxLQUFLO3lDQUtMLEtBQUs7dUJBU0wsS0FBSyxTQUFDLG9CQUFvQjt5QkFDMUIsS0FBSyxTQUFDLHNCQUFzQjt3QkFDNUIsS0FBSyxTQUFDLHFCQUFxQjt3Q0FDM0IsS0FBSztvQ0FJTCxLQUFLOztrQ0EzRFI7RUFRZ0QsY0FBYztTQUFqRCx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge05nRm9yT2ZDb250ZXh0fSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQge0RpcmVjdGl2ZSwgSW5wdXQsIEl0ZXJhYmxlRGlmZmVycywgTmdJdGVyYWJsZSwgT25EZXN0cm95LCBPbkluaXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge05nWm9uZSwgVGVtcGxhdGVSZWYsIFRyYWNrQnlGdW5jdGlvbiwgVmlld0NvbnRhaW5lclJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7REVGQVVMVFN9IGZyb20gJy4vZGVmYXVsdHMnO1xyXG5pbXBvcnQge0luZmluaXRlU2Nyb2xsfSBmcm9tICcuL2luZmluaXRlLXNjcm9sbCc7XHJcblxyXG5ARGlyZWN0aXZlKHtzZWxlY3RvcjogJ1tpbmZpbml0ZVNjcm9sbF0nfSlcclxuZXhwb3J0IGNsYXNzIEluZmluaXRlU2Nyb2xsRGlyZWN0aXZlPFQ+IGV4dGVuZHMgSW5maW5pdGVTY3JvbGw8VD4gaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgcHJpdmF0ZSBfaXRlbXM6IEFycmF5PFQ+O1xyXG4gIHByaXZhdGUgX3Bvc2l0aW9uSW5pdGlhbCA9IERFRkFVTFRTLlBPU0lUSU9OO1xyXG5cclxuICBwcml2YXRlIF9kdW1taWVzID0gMDtcclxuICBwcml2YXRlIF9vdXRPZkl0ZW1zID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHZpZXdDb250YWluZXI6IFZpZXdDb250YWluZXJSZWYsIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxOZ0Zvck9mQ29udGV4dDxUPj4sIGRpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycywgem9uZTogTmdab25lKSB7XHJcbiAgICBzdXBlcihkaWZmZXJzLCB6b25lKTtcclxuICAgIHRoaXMuY3JlYXRlTmdGb3Iodmlld0NvbnRhaW5lciwgdGVtcGxhdGVSZWYpO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBzZXQgaW5maW5pdGVTY3JvbGxPZihpbmZpbml0ZVNjcm9sbE9mOiBOZ0l0ZXJhYmxlPFQ+KSB7XHJcbiAgICBpZiAoaW5maW5pdGVTY3JvbGxPZikge1xyXG4gICAgICB0aGlzLl9pdGVtcyA9IEFycmF5LmZyb20oaW5maW5pdGVTY3JvbGxPZik7XHJcbiAgICB9XHJcbiAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy5fcG9zaXRpb25Jbml0aWFsO1xyXG4gICAgdGhpcy5fZHVtbWllcyA9IDA7XHJcbiAgICB0aGlzLnVwZGF0ZUl0ZW1zKCk7XHJcbiAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gIH1cclxuICBASW5wdXQoKVxyXG4gIHNldCBpbmZpbml0ZVNjcm9sbFRyYWNrQnkoZm46IFRyYWNrQnlGdW5jdGlvbjxUPikge1xyXG4gICAgdGhpcy5fbmdGb3IubmdGb3JUcmFja0J5ID0gZm47XHJcbiAgfVxyXG4gIGdldCBpbmZpbml0ZVNjcm9sbFRyYWNrQnkoKTogVHJhY2tCeUZ1bmN0aW9uPFQ+IHtcclxuICAgIHJldHVybiB0aGlzLl9uZ0Zvci5uZ0ZvclRyYWNrQnk7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCBpbmZpbml0ZVNjcm9sbFRlbXBsYXRlKHZhbHVlOiBUZW1wbGF0ZVJlZjxOZ0Zvck9mQ29udGV4dDxUPj4pIHtcclxuICAgIHRoaXMuX25nRm9yLm5nRm9yVGVtcGxhdGUgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IGluZmluaXRlU2Nyb2xsUG9zaXRpb24ocG9zaXRpb24pIHtcclxuICAgIGlmIChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkIHx8IHBvc2l0aW9uID09PSBudWxsKSB7XHJcbiAgICAgIHRoaXMucG9zaXRpb24gPSBERUZBVUxUUy5QT1NJVElPTjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcclxuICAgIH1cclxuICAgIHRoaXMuX3Bvc2l0aW9uSW5pdGlhbCA9IHBvc2l0aW9uO1xyXG4gIH1cclxuICBASW5wdXQoJ2luZmluaXRlU2Nyb2xsU3RlcCcpIHN0ZXAgPSBERUZBVUxUUy5TVEVQO1xyXG4gIEBJbnB1dCgnaW5maW5pdGVTY3JvbGxPZmZzZXQnKSBvZmZzZXQgPSBERUZBVUxUUy5PRkZTRVQ7XHJcbiAgQElucHV0KCdpbmZpbml0ZVNjcm9sbERlbGF5JykgZGVsYXkgPSBERUZBVUxUUy5ERUxBWTtcclxuICBASW5wdXQoKVxyXG4gIHNldCBpbmZpbml0ZVNjcm9sbExvYWRpbmcobG9hZGluZzogKGxvYWRpbmc6IGJvb2xlYW4pID0+IHZvaWQpIHtcclxuICAgIHRoaXMuc3Vic2NyaWJlTG9hZGluZyhsb2FkaW5nKTtcclxuICB9XHJcbiAgQElucHV0KClcclxuICBzZXQgaW5maW5pdGVTY3JvbGxFbmQoc2Nyb2xsRW5kOiAocG9zaXRpb246IG51bWJlciwgaW50ZXJ2YWw6IG51bWJlcikgPT4gT2JzZXJ2YWJsZTxOZ0l0ZXJhYmxlPFQ+Pikge1xyXG4gICAgdGhpcy5zdWJzY3JpYmVFbmQoc2Nyb2xsRW5kKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCB1cGRhdGUoKSB7XHJcbiAgICBpZiAoIXRoaXMuX2l0ZW1zKSB7XHJcbiAgICAgIHRoaXMuX2l0ZW1zID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX2l0ZW1zICYmICghdGhpcy5faXRlbXMubGVuZ3RoIHx8IHRoaXMuX2l0ZW1zLmV2ZXJ5KChpdGVtKSA9PiBpdGVtID09PSB1bmRlZmluZWQpKSkge1xyXG4gICAgICB0aGlzLl9pdGVtcyA9IFtdO1xyXG4gICAgICB0aGlzLmFkZER1bW1pZXMoKTtcclxuICAgICAgdGhpcy51cGRhdGVJdGVtcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnBvc2l0aW9uIDwgdGhpcy5faXRlbXMubGVuZ3RoIC0gdGhpcy5fZHVtbWllcykge1xyXG4gICAgICB0aGlzLmxvYWRpbmckLm5leHQodHJ1ZSk7XHJcbiAgICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcclxuICAgICAgdGhpcy5fdXBkYXRlQWZ0ZXJSZW5kZXIkLm5leHQoKTtcclxuICAgICAgdGhpcy5wb3NpdGlvbiArPSB0aGlzLnN0ZXA7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbkVuZCkge1xyXG4gICAgICB0aGlzLmxvYWRpbmckLm5leHQodHJ1ZSk7XHJcbiAgICAgIHRoaXMuX2VuZCQubmV4dCgpO1xyXG4gICAgICB0aGlzLnBvc2l0aW9uICs9IHRoaXMuc3RlcDtcclxuICAgICAgdGhpcy5hZGREdW1taWVzKCk7XHJcbiAgICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBuZXdJdGVtcyhuZXdJdGVtczogTmdJdGVyYWJsZTxUPikge1xyXG4gICAgd2hpbGUgKHRoaXMuX2R1bW1pZXMgPiAwKSB7XHJcbiAgICAgIGlmICh0aGlzLl9pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLl9pdGVtcy5wb3AoKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLl9kdW1taWVzLS07XHJcbiAgICB9XHJcbiAgICBjb25zdCBuZXdJdGVtc0FycmF5ID0gQXJyYXkuZnJvbShuZXdJdGVtcyk7XHJcbiAgICB0aGlzLl9pdGVtcyA9IHRoaXMuX2l0ZW1zLmNvbmNhdChuZXdJdGVtc0FycmF5KTtcclxuICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcclxuICAgIC8vIG9ubHkgY29udGludWUgd2hlbiBuZXdJdGVtcyBhcnJpdmVcclxuICAgIGlmIChuZXdJdGVtc0FycmF5Lmxlbmd0aCkge1xyXG4gICAgICB0aGlzLl91cGRhdGVBZnRlclJlbmRlciQubmV4dCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fb3V0T2ZJdGVtcyA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVJdGVtcygpIHtcclxuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5faXRlbXMpIHtcclxuICAgICAgICAvLyB1cGRhdGUgbmdGb3JPZjxUPiBkaXJlY3RpdmVcclxuICAgICAgICB0aGlzLl9uZ0Zvci5uZ0Zvck9mID0gdGhpcy5faXRlbXMuc2xpY2UoMCwgdGhpcy5wb3NpdGlvbik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGREdW1taWVzKCkge1xyXG4gICAgaWYgKCF0aGlzLl9kdW1taWVzICYmICF0aGlzLl9vdXRPZkl0ZW1zKSB7XHJcbiAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5faXRlbXMuY29uY2F0KEFycmF5KHRoaXMuc3RlcCkuZmlsbCh1bmRlZmluZWQpKTtcclxuICAgICAgdGhpcy5fZHVtbWllcyArPSB0aGlzLnN0ZXA7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==